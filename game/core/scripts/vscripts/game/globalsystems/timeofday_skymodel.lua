--========= Copyright (c) Valve Corporation. All Rights Reserved. ============
--============================================================================

-------------------------------------------------------------------------------
SkyModel_PhysicalSunLightColors = 
{
    
    {
        Vector(0.007496, 0.002563, 0.000053),
        Vector(0.000156, 0.000044, 0.000001),
        Vector(0.000000, 0.000000, 0.000000),
        Vector(0.000000, 0.000000, 0.000000)
    },
    
    {
        Vector(0.049388, 0.023605, 0.001448),
        Vector(0.007968, 0.003453, 0.000223),
        Vector(0.000503, 0.000189, 0.000013),
        Vector(0.000000, 0.000000, 0.000000)
    },
    
    {
        Vector(0.092625, 0.054172, 0.006706),
        Vector(0.030971, 0.017011, 0.002178),
        Vector(0.006739, 0.003399, 0.000457),
        Vector(0.000026, 0.000009, 0.000002)
    },
    
    {
        Vector(0.131707, 0.087079, 0.016873),
        Vector(0.060962, 0.038559, 0.007669),
        Vector(0.021403, 0.012747, 0.002627),
        Vector(0.000495, 0.000237, 0.000057)
    },
    
    {
        Vector(0.165510, 0.118743, 0.031222),
        Vector(0.091650, 0.063546, 0.017070),
        Vector(0.041392, 0.027369, 0.007576),
        Vector(0.002450, 0.001371, 0.000423)
    },
    
    {
        Vector(0.192771, 0.146350, 0.047669),
        Vector(0.119430, 0.088162, 0.029228),
        Vector(0.062847, 0.044701, 0.015196),
        Vector(0.006521, 0.004047, 0.001507)
    },
    
    {
        Vector(0.215534, 0.170675, 0.065146),
        Vector(0.144230, 0.111497, 0.043233),
        Vector(0.084212, 0.063071, 0.024982),
        Vector(0.012755, 0.008530, 0.003655)
    },
    
    {
        Vector(0.234291, 0.191419, 0.082464),
        Vector(0.165697, 0.132627, 0.057947),
        Vector(0.104257, 0.081218, 0.036122),
        Vector(0.020646, 0.014592, 0.006947)
    },
    
    {
        Vector(0.250426, 0.209723, 0.099388),
        Vector(0.184629, 0.151878, 0.072912),
        Vector(0.122893, 0.098709, 0.048142),
        Vector(0.029732, 0.021931, 0.011369)
    },
    
    {
        Vector(0.263087, 0.224720, 0.114828),
        Vector(0.200479, 0.168478, 0.087102),
        Vector(0.139449, 0.114690, 0.060184),
        Vector(0.039444, 0.030071, 0.016664)
    },
    
    {
        Vector(0.274500, 0.238301, 0.129630),
        Vector(0.214769, 0.183718, 0.100976),
        Vector(0.154755, 0.129795, 0.072338),
        Vector(0.049574, 0.038826, 0.022721)
    },
    
    {
        Vector(0.283720, 0.249559, 0.142942),
        Vector(0.226763, 0.196847, 0.113797),
        Vector(0.168168, 0.143365, 0.083942),
        Vector(0.059615, 0.047737, 0.029234)
    },
    
    {
        Vector(0.291745, 0.259520, 0.155231),
        Vector(0.237437, 0.208643, 0.125893),
        Vector(0.180322, 0.155878, 0.095182),
        Vector(0.069587, 0.056794, 0.036151)
    },
    
    {
        Vector(0.299426, 0.268915, 0.166975),
        Vector(0.247391, 0.219728, 0.137545),
        Vector(0.191767, 0.167681, 0.106148),
        Vector(0.079474, 0.065904, 0.043352)
    },
    
    {
        Vector(0.306065, 0.277181, 0.177724),
        Vector(0.256200, 0.229634, 0.148360),
        Vector(0.202089, 0.178473, 0.116522),
        Vector(0.088983, 0.074813, 0.050627)
    },
    
    {
        Vector(0.311422, 0.284139, 0.187358),
        Vector(0.263711, 0.238210, 0.158208),
        Vector(0.211130, 0.188137, 0.126173),
        Vector(0.097941, 0.083354, 0.057835)
    },
    
    {
        Vector(0.316510, 0.290603, 0.196320),
        Vector(0.270626, 0.246155, 0.167436),
        Vector(0.219525, 0.197146, 0.135338),
        Vector(0.106649, 0.091687, 0.064961)
    },
    
    {
        Vector(0.320709, 0.296078, 0.204345),
        Vector(0.276547, 0.253075, 0.175813),
        Vector(0.226934, 0.205193, 0.143799),
        Vector(0.114822, 0.099594, 0.071884)
    },
    
    {
        Vector(0.325124, 0.301688, 0.212319),
        Vector(0.282528, 0.259948, 0.184105),
        Vector(0.234206, 0.213073, 0.152153),
        Vector(0.122784, 0.107398, 0.078897)
    },
    
    {
        Vector(0.328738, 0.306378, 0.219346),
        Vector(0.287644, 0.265906, 0.191517),
        Vector(0.240623, 0.220077, 0.159756),
        Vector(0.130170, 0.114708, 0.085581)
    },
    
    {
        Vector(0.332528, 0.311153, 0.226333),
        Vector(0.292763, 0.271844, 0.198833),
        Vector(0.246927, 0.226951, 0.167263),
        Vector(0.137373, 0.121890, 0.092248)
    },
    
    {
        Vector(0.335044, 0.314573, 0.231945),
        Vector(0.296613, 0.276458, 0.204918),
        Vector(0.252029, 0.232603, 0.173678),
        Vector(0.143819, 0.128355, 0.098305)
    },
    
    {
        Vector(0.337482, 0.317889, 0.237343),
        Vector(0.300265, 0.280851, 0.210798),
        Vector(0.256842, 0.237959, 0.179862),
        Vector(0.150017, 0.134596, 0.104206)
    },
    
    {
        Vector(0.340349, 0.321561, 0.242885),
        Vector(0.304174, 0.285454, 0.216725),
        Vector(0.261767, 0.243408, 0.186056),
        Vector(0.156142, 0.140779, 0.110107)
    },
    
    {
        Vector(0.342498, 0.324470, 0.247683),
        Vector(0.307322, 0.289288, 0.221900),
        Vector(0.265947, 0.248128, 0.191583),
        Vector(0.161686, 0.146432, 0.115613)
    },
    
    {
        Vector(0.344353, 0.327007, 0.251973),
        Vector(0.310143, 0.292714, 0.226591),
        Vector(0.269739, 0.252416, 0.196646),
        Vector(0.166877, 0.151730, 0.120798)
    },
    
    {
        Vector(0.346633, 0.329941, 0.256528),
        Vector(0.313318, 0.296436, 0.231518),
        Vector(0.273730, 0.256888, 0.201861),
        Vector(0.172103, 0.157055, 0.126034)
    },
    
    {
        Vector(0.348796, 0.332720, 0.260848),
        Vector(0.316317, 0.299951, 0.236201),
        Vector(0.277499, 0.261111, 0.206827),
        Vector(0.177073, 0.162139, 0.131073)
    },
    
    {
        Vector(0.350331, 0.334838, 0.264469),
        Vector(0.318631, 0.302790, 0.240195),
        Vector(0.280642, 0.264674, 0.211164),
        Vector(0.181483, 0.166710, 0.135656)
    },
    
    {
        Vector(0.352151, 0.337214, 0.268226),
        Vector(0.321128, 0.305800, 0.244272),
        Vector(0.283901, 0.268325, 0.215544),
        Vector(0.185850, 0.171249, 0.140220)
    },
    
    {
        Vector(0.353781, 0.339337, 0.271641),
        Vector(0.323410, 0.308540, 0.248010),
        Vector(0.286876, 0.271686, 0.219589),
        Vector(0.189977, 0.175525, 0.144533)
    },
    
    {
        Vector(0.354796, 0.340800, 0.274408),
        Vector(0.325100, 0.310646, 0.251140),
        Vector(0.289234, 0.274442, 0.223060),
        Vector(0.193662, 0.179344, 0.148441)
    },
    
    {
        Vector(0.355417, 0.341799, 0.276588),
        Vector(0.326379, 0.312280, 0.253695),
        Vector(0.291177, 0.276728, 0.225985),
        Vector(0.196960, 0.182765, 0.151930)
    },
    
    {
        Vector(0.357070, 0.343874, 0.279796),
        Vector(0.328547, 0.314841, 0.257139),
        Vector(0.293902, 0.279783, 0.229673),
        Vector(0.200624, 0.186593, 0.155860)
    },
    
    {
        Vector(0.358164, 0.345360, 0.282398),
        Vector(0.330156, 0.316818, 0.259987),
        Vector(0.296106, 0.282276, 0.232805),
        Vector(0.203817, 0.189970, 0.159361)
    },
    
    {
        Vector(0.359755, 0.347345, 0.285413),
        Vector(0.332190, 0.319213, 0.263206),
        Vector(0.298639, 0.285103, 0.236235),
        Vector(0.207157, 0.193490, 0.163015)
    },
    
    {
        Vector(0.359731, 0.347624, 0.286611),
        Vector(0.332708, 0.319999, 0.264759),
        Vector(0.299749, 0.286458, 0.238130),
        Vector(0.209447, 0.195932, 0.165564)
    },
    
    {
        Vector(0.360753, 0.349012, 0.288917),
        Vector(0.334165, 0.321770, 0.267326),
        Vector(0.301660, 0.288662, 0.240908),
        Vector(0.212227, 0.198881, 0.168678)
    },
    
    {
        Vector(0.362463, 0.351036, 0.291700),
        Vector(0.336221, 0.324111, 0.270297),
        Vector(0.304071, 0.291341, 0.244036),
        Vector(0.215301, 0.202087, 0.171981)
    },
    
    {
        Vector(0.362609, 0.351409, 0.292933),
        Vector(0.336787, 0.324918, 0.271783),
        Vector(0.305098, 0.292614, 0.245816),
        Vector(0.217349, 0.204249, 0.174277)
    },
    
    {
        Vector(0.363522, 0.352560, 0.294895),
        Vector(0.338036, 0.326425, 0.273916),
        Vector(0.306708, 0.294486, 0.248165),
        Vector(0.219758, 0.206766, 0.176926)
    },
    
    {
        Vector(0.364016, 0.353261, 0.296305),
        Vector(0.338872, 0.327482, 0.275530),
        Vector(0.307915, 0.295909, 0.250021),
        Vector(0.221796, 0.208908, 0.179172)
    },
    
    {
        Vector(0.364930, 0.354427, 0.298132),
        Vector(0.340085, 0.328937, 0.277534),
        Vector(0.309436, 0.297645, 0.252209),
        Vector(0.223981, 0.211223, 0.181611)
    },
    
    {
        Vector(0.365621, 0.355357, 0.299661),
        Vector(0.341072, 0.330147, 0.279255),
        Vector(0.310729, 0.299127, 0.254123),
        Vector(0.225938, 0.213310, 0.183812)
    },
    
    {
        Vector(0.366200, 0.356139, 0.300970),
        Vector(0.341929, 0.331190, 0.280748),
        Vector(0.311883, 0.300440, 0.255800),
        Vector(0.227726, 0.215211, 0.185808)
    },
    
    {
        Vector(0.366413, 0.356542, 0.301960),
        Vector(0.342414, 0.331855, 0.281912),
        Vector(0.312685, 0.301403, 0.257142),
        Vector(0.229188, 0.216789, 0.187537)
    },
    
    {
        Vector(0.367414, 0.357725, 0.303636),
        Vector(0.343612, 0.333224, 0.283696),
        Vector(0.314127, 0.302998, 0.259025),
        Vector(0.231066, 0.218770, 0.189642)
    },
    
    {
        Vector(0.367471, 0.357918, 0.304303),
        Vector(0.343910, 0.333649, 0.284523),
        Vector(0.314722, 0.303711, 0.260015),
        Vector(0.232267, 0.220057, 0.191047)
    },
    
    {
        Vector(0.367576, 0.358166, 0.304991),
        Vector(0.344235, 0.334104, 0.285358),
        Vector(0.315307, 0.304415, 0.261001),
        Vector(0.233411, 0.221272, 0.192377)
    },
    
    {
        Vector(0.368430, 0.359216, 0.306482),
        Vector(0.345249, 0.335291, 0.286942),
        Vector(0.316498, 0.305757, 0.262664),
        Vector(0.234974, 0.222905, 0.194153)
    },
    
    {
        Vector(0.368473, 0.359387, 0.307001),
        Vector(0.345489, 0.335642, 0.287604),
        Vector(0.316958, 0.306316, 0.263470),
        Vector(0.235951, 0.223922, 0.195254)
    },
    
    {
        Vector(0.368062, 0.359057, 0.306981),
        Vector(0.345285, 0.335510, 0.287736),
        Vector(0.316987, 0.306414, 0.263777),
        Vector(0.236534, 0.224549, 0.195940)
    },
    
    {
        Vector(0.369084, 0.360212, 0.308475),
        Vector(0.346409, 0.336755, 0.289256),
        Vector(0.318213, 0.307756, 0.265344),
        Vector(0.237935, 0.226045, 0.197526)
    },
    
    {
        Vector(0.369460, 0.360674, 0.309262),
        Vector(0.346920, 0.337345, 0.290093),
        Vector(0.318861, 0.308490, 0.266279),
        Vector(0.238857, 0.227067, 0.198618)
    },
    
    {
        Vector(0.369357, 0.360606, 0.309435),
        Vector(0.346963, 0.337425, 0.290343),
        Vector(0.319061, 0.308738, 0.266660),
        Vector(0.239399, 0.227685, 0.199260)
    },
    
    {
        Vector(0.370631, 0.362023, 0.311174),
        Vector(0.348270, 0.338874, 0.292060),
        Vector(0.320402, 0.310208, 0.268363),
        Vector(0.240754, 0.229142, 0.200843)
    },
    
    {
        Vector(0.370574, 0.362017, 0.311367),
        Vector(0.348304, 0.338979, 0.292329),
        Vector(0.320559, 0.310424, 0.268721),
        Vector(0.241206, 0.229633, 0.201394)
    },
    
    {
        Vector(0.370218, 0.361671, 0.311133),
        Vector(0.348044, 0.338758, 0.292195),
        Vector(0.320435, 0.310327, 0.268697),
        Vector(0.241428, 0.229865, 0.201638)
    },
    
    {
        Vector(0.370759, 0.362295, 0.311951),
        Vector(0.348615, 0.339426, 0.293035),
        Vector(0.321056, 0.311027, 0.269551),
        Vector(0.242154, 0.230633, 0.202495)
    },
    
    {
        Vector(0.370073, 0.361601, 0.311322),
        Vector(0.348022, 0.338830, 0.292492),
        Vector(0.320577, 0.310548, 0.269108),
        Vector(0.241955, 0.230444, 0.202307)
    },
    
    {
        Vector(0.370836, 0.362427, 0.312232),
        Vector(0.348785, 0.339644, 0.293379),
        Vector(0.321334, 0.311351, 0.269968),
        Vector(0.242633, 0.231161, 0.203058)
    },
    
    {
        Vector(0.371088, 0.362720, 0.312614),
        Vector(0.349063, 0.339952, 0.293766),
        Vector(0.321636, 0.311685, 0.270361),
        Vector(0.242951, 0.231512, 0.203444)
    },
    
    {
        Vector(0.369864, 0.361455, 0.311386),
        Vector(0.347942, 0.338790, 0.292632),
        Vector(0.320636, 0.310656, 0.269344),
        Vector(0.242256, 0.230819, 0.202740)
    },
    
    {
        Vector(0.370627, 0.362260, 0.312218),
        Vector(0.348674, 0.339554, 0.293422),
        Vector(0.321323, 0.311371, 0.270080),
        Vector(0.242795, 0.231376, 0.203317)
    }
}


-------------------------------------------------------------------------------
SkyModel_PhysicalSkyLightColors = 
{
    
    {
        Vector(0.011637, 0.011334, 0.008812),
        Vector(0.009689, 0.009340, 0.007869),
        Vector(0.006938, 0.006988, 0.006639),
        Vector(0.004169, 0.004419, 0.005154)
    },
    
    {
        Vector(0.027075, 0.033311, 0.040393),
        Vector(0.041093, 0.043314, 0.042121),
        Vector(0.041919, 0.040958, 0.036863),
        Vector(0.033924, 0.030959, 0.027129)
    },
    
    {
        Vector(0.035347, 0.046365, 0.066278),
        Vector(0.060703, 0.066906, 0.073192),
        Vector(0.073223, 0.073915, 0.070246),
        Vector(0.075799, 0.071898, 0.062173)
    },
    
    {
        Vector(0.040957, 0.055365, 0.086485),
        Vector(0.072931, 0.082589, 0.098203),
        Vector(0.098533, 0.101858, 0.101469),
        Vector(0.118517, 0.115718, 0.102160)
    },
    
    {
        Vector(0.045149, 0.062064, 0.102836),
        Vector(0.081103, 0.093847, 0.118703),
        Vector(0.120149, 0.126196, 0.130871),
        Vector(0.160606, 0.158816, 0.144477)
    },
    
    {
        Vector(0.048500, 0.067202, 0.116313),
        Vector(0.086676, 0.102243, 0.135724),
        Vector(0.139728, 0.148486, 0.158570),
        Vector(0.203352, 0.202272, 0.187332)
    },
    
    {
        Vector(0.051268, 0.071189, 0.127398),
        Vector(0.090346, 0.108452, 0.149737),
        Vector(0.157831, 0.169366, 0.184035),
        Vector(0.246681, 0.246828, 0.229128)
    },
    
    {
        Vector(0.053572, 0.074326, 0.136325),
        Vector(0.092570, 0.112822, 0.160970),
        Vector(0.173685, 0.188022, 0.206108),
        Vector(0.287229, 0.289772, 0.267243)
    },
    
    {
        Vector(0.055481, 0.076875, 0.143254),
        Vector(0.093733, 0.115631, 0.169606),
        Vector(0.185603, 0.202627, 0.223518),
        Vector(0.319240, 0.325486, 0.298555)
    },
    
    {
        Vector(0.057051, 0.079062, 0.148390),
        Vector(0.094269, 0.117239, 0.175878),
        Vector(0.192042, 0.211441, 0.235421),
        Vector(0.337225, 0.348169, 0.320611)
    },
    
    {
        Vector(0.058330, 0.081070, 0.152029),
        Vector(0.094567, 0.118023, 0.180010),
        Vector(0.192284, 0.213461, 0.241372),
        Vector(0.338115, 0.353979, 0.331714)
    },
    
    {
        Vector(0.059368, 0.083009, 0.154546),
        Vector(0.094921, 0.118290, 0.182136),
        Vector(0.186895, 0.208739, 0.241159),
        Vector(0.322618, 0.342253, 0.330803)
    },
    
    {
        Vector(0.060235, 0.084913, 0.156342),
        Vector(0.095598, 0.118358, 0.182276),
        Vector(0.177771, 0.198739, 0.234765),
        Vector(0.295230, 0.316413, 0.317570)
    },
    
    {
        Vector(0.061066, 0.086753, 0.157749),
        Vector(0.096841, 0.118507, 0.180349),
        Vector(0.167135, 0.185672, 0.222194),
        Vector(0.261397, 0.282249, 0.292063)
    },
    
    {
        Vector(0.062234, 0.088570, 0.158937),
        Vector(0.099002, 0.119097, 0.176207),
        Vector(0.156200, 0.171563, 0.203163),
        Vector(0.223789, 0.245180, 0.253753)
    },
    
    {
        Vector(0.063449, 0.090386, 0.160101),
        Vector(0.101280, 0.119746, 0.171801),
        Vector(0.145248, 0.157370, 0.183365),
        Vector(0.185773, 0.207872, 0.213923)
    }
}


-------------------------------------------------------------------------------
SkyModel_StandardMeridians = 
{
    ["UTC-12:00"] = Deg2Rad(-180.0),
    ["UTC-11:00"] = Deg2Rad(-165.0),
    ["UTC-10:00"] = Deg2Rad(-150.0),
    ["UTC-09:30"] = Deg2Rad(-142.5),
    ["UTC-09:00"] = Deg2Rad(-135.0),
    ["UTC-08:00"] = Deg2Rad(-120.0),
    ["UTC-07:00"] = Deg2Rad(-105.0),
    ["UTC-06:00"] = Deg2Rad(-90.0),
    ["UTC-05:00"] = Deg2Rad(-75.0),
    ["UTC-04:30"] = Deg2Rad(-67.5),
    ["UTC-04:00"] = Deg2Rad(-60.0),
    ["UTC-03:30"] = Deg2Rad(-52.5),
    ["UTC-03:00"] = Deg2Rad(-45.0),
    ["UTC-02:00"] = Deg2Rad(-30.0),
    ["UTC-01:00"] = Deg2Rad(-15.0),
    ["UTC+-00:00"] = Deg2Rad(0.0),
    ["UTC+01:00"] = Deg2Rad(15.0),
    ["UTC+02:00"] = Deg2Rad(30.0),
    ["UTC+03:00"] = Deg2Rad(45.0),
    ["UTC+03:30"] = Deg2Rad(52.5),
    ["UTC+04:00"] = Deg2Rad(60.0),
    ["UTC+04:30"] = Deg2Rad(67.5),
    ["UTC+05:00"] = Deg2Rad(75.0),
    ["UTC+05:30"] = Deg2Rad(82.5),
    ["UTC+05:45"] = Deg2Rad(86.25),
    ["UTC+06:00"] = Deg2Rad(90.0),
    ["UTC+06:30"] = Deg2Rad(97.5),
    ["UTC+07:00"] = Deg2Rad(105.0),
    ["UTC+08:00"] = Deg2Rad(120.0),
    ["UTC+08:45"] = Deg2Rad(131.25),
    ["UTC+09:00"] = Deg2Rad(135.0),
    ["UTC+09:30"] = Deg2Rad(142.5),
    ["UTC+09:45"] = Deg2Rad(146.25),
    ["UTC+10:00"] = Deg2Rad(150.0),
    ["UTC+10:30"] = Deg2Rad(157.5),
    ["UTC+11:00"] = Deg2Rad(165.0),
    ["UTC+11:30"] = Deg2Rad(172.5),
    ["UTC+12:00"] = Deg2Rad(180.0),
    ["UTC+12:45"] = Deg2Rad(191.25),
    ["UTC+13:00"] = Deg2Rad(195.0),
    ["UTC+14:00"] = Deg2Rad(210.0)
}


-------------------------------------------------------------------------------
SkyModel_Locations = 
{
    Seattle = 
    {
        Latitude = Deg2Rad(47.6097),
        Longitude = Deg2Rad(-122.3331),
        Meridian = SkyModel_StandardMeridians["UTC-08:00"]
    },
    ["New York"] = 
    {
        Latitude = Deg2Rad(40.7142),
        Longitude = Deg2Rad(-74.0064),
        Meridian = SkyModel_StandardMeridians["UTC-05:00"]
    },
    ["Rio de Janeiro"] = 
    {
        Latitude = Deg2Rad(-22.9083),
        Longitude = Deg2Rad(-43.2436),
        Meridian = SkyModel_StandardMeridians["UTC-03:00"]
    },
    ["Mexico City"] = 
    {
        Latitude = Deg2Rad(19.1300),
        Longitude = Deg2Rad(-99.4000),
        Meridian = SkyModel_StandardMeridians["UTC-06:00"]
    },
    London = 
    {
        Latitude = Deg2Rad(51.5171),
        Longitude = Deg2Rad(-0.1062),
        Meridian = SkyModel_StandardMeridians["UTC+-00:00"]
    },
    Moscow = 
    {
        Latitude = Deg2Rad(55.7517),
        Longitude = Deg2Rad(37.6178),
        Meridian = SkyModel_StandardMeridians["UTC+04:00"]
    },
    Cairo = 
    {
        Latitude = Deg2Rad(30.0566),
        Longitude = Deg2Rad(31.2262),
        Meridian = SkyModel_StandardMeridians["UTC+02:00"]
    },
    Lagos = 
    {
        Latitude = Deg2Rad(6.4500),
        Longitude = Deg2Rad(3.3833),
        Meridian = SkyModel_StandardMeridians["UTC+01:00"]
    },
    ["Cape Town"] = 
    {
        Latitude = Deg2Rad(-33.9767),
        Longitude = Deg2Rad(18.4244),
        Meridian = SkyModel_StandardMeridians["UTC+02:00"]
    },
    Mumbai = 
    {
        Latitude = Deg2Rad(18.9647),
        Longitude = Deg2Rad(72.8258),
        Meridian = SkyModel_StandardMeridians["UTC+05:30"]
    },
    Shanghai = 
    {
        Latitude = Deg2Rad(31.2000),
        Longitude = Deg2Rad(121.5000),
        Meridian = SkyModel_StandardMeridians["UTC+08:00"]
    },
    Tokyo = 
    {
        Latitude = Deg2Rad(35.6833),
        Longitude = Deg2Rad(139.7667),
        Meridian = SkyModel_StandardMeridians["UTC+09:00"]
    },
    Seoul = 
    {
        Latitude = Deg2Rad(37.5665),
        Longitude = Deg2Rad(126.9780),
        Meridian = SkyModel_StandardMeridians["UTC+09:00"]
    },
    Perth = 
    {
        Latitude = Deg2Rad(-31.9554),
        Longitude = Deg2Rad(115.8585),
        Meridian = SkyModel_StandardMeridians["UTC+08:00"]
    },
    Wellington = 
    {
        Latitude = Deg2Rad(-41.2889),
        Longitude = Deg2Rad(174.7772),
        Meridian = SkyModel_StandardMeridians["UTC+12:00"]
    },
    ["Portland, Maine"] = 
    {
        Latitude = Deg2Rad(43.6614),
        Longitude = Deg2Rad(-70.2558),
        Meridian = SkyModel_StandardMeridians["UTC-05:00"]
    }
}


----------------------------------------------------------------------------------------------------------
function SkyModel_HorizontalToGameWorldXYZ(azimuth, altitude) 
    local x = -math.sin(0.5 * math.pi - altitude) * math.sin(azimuth)
    local y = -math.sin(0.5 * math.pi - altitude) * math.cos(azimuth)
    local z = math.cos(0.5 * math.pi - altitude)
    
    return Vector(x, y, z)
end


-------------------------------------------------------------------------------
function SkyModel_EquatorialToGameWorldXYZ(hourAngle, declinationAngle, rightAscensionAngle, northAngle) 
    northAngle = northAngle or 0.0
    local sinLat = math.sin(rightAscensionAngle)
    local cosLat = math.cos(rightAscensionAngle)
    local sinDec = math.sin(declinationAngle)
    local cosDec = math.cos(declinationAngle)
    
    local altitude = math.asin(sinLat * sinDec - cosLat * cosDec * math.cos(hourAngle))
    local azimuth = math.atan2(-cosDec * math.sin(hourAngle), cosLat * sinDec - sinLat * cosDec * math.cos(hourAngle))
    
    return SkyModel_HorizontalToGameWorldXYZ(azimuth - northAngle, altitude)
end


-------------------------------------------------------------------------------
function SkyModel_SunLightDirectionForDayNightCycle(dayNightCycle, time) 
    local date = Clamp(dayNightCycle.Date, 1.0, 365.0)
    
    local solarTime = time * (math.pi / 12.0)
    solarTime = solarTime + (0.170 * math.pi / 12.0) * math.sin(4.0 * math.pi * (date - 80.0) / 373.0)
    solarTime = solarTime - (0.129 * math.pi / 12.0) * math.sin(2.0 * math.pi * (date - 8.0) / 355.0)
    solarTime = solarTime + dayNightCycle.Longitude - dayNightCycle.Meridian
    
    local solarDeclination = 0.4093 * math.sin(2.0 * math.pi * (date - 81.0) / 368.0)
    
    return SkyModel_EquatorialToGameWorldXYZ(solarTime, solarDeclination, dayNightCycle.Latitude, dayNightCycle.NorthAngle)
end


-------------------------------------------------------------------------------
function SkyModel_SunLightColorForLightParameters(skyHaze, sunLightDirectionZ) 
    if sunLightDirectionZ <= 0.0 then 
        return Vector(0.0, 0.0, 0.0)
    end
    
    local elevation = math.asin(math.max(sunLightDirectionZ, 0.0))
    elevation = RemapValClamped(elevation, 0.0, 0.5 * math.pi, 0.0, #SkyModel_PhysicalSunLightColors)
    
    local turbidity = RemapValClamped(skyHaze, 0.0, 1.0, 0.0, #SkyModel_PhysicalSunLightColors[1])
    
    local eLower = Clamp(math.floor(elevation), 1, #SkyModel_PhysicalSunLightColors - 1)
    local tLower = Clamp(math.floor(turbidity), 1, #SkyModel_PhysicalSunLightColors[1] - 1)
    
    local e = elevation - eLower
    local t = turbidity - tLower
    
    local eLtL = SkyModel_PhysicalSunLightColors[eLower + 0][tLower + 0]
    local eLtU = SkyModel_PhysicalSunLightColors[eLower + 0][tLower + 1]
    local eUtL = SkyModel_PhysicalSunLightColors[eLower + 1][tLower + 0]
    local eUtU = SkyModel_PhysicalSunLightColors[eLower + 1][tLower + 1]
    
    local eL = VectorLerp(t, eLtL, eLtU)
    local eU = VectorLerp(t, eUtL, eUtU)
    return VectorLerp(e, eL, eU)
end


-------------------------------------------------------------------------------
function SkyModel_CalculateClockTime(startTime, gameTime, dayNightCycle) 
    if dayNightCycle.DayLength ~= 0.0 then 
        return startTime + 24.0 * gameTime / dayNightCycle.DayLength
    end
    
    return startTime
end


-------------------------------------------------------------------------------
function SkyModel_SkyLightColorForLightParameters(skyHaze, sunLightDirectionZ) 
    if sunLightDirectionZ <= 0.0 then 
        -- Not strictly true since we have twilight for the sun up to 18 degrees below the horizon
        return Vector(0.0, 0.0, 0.0)
    end
    
    local elevation = math.asin(math.max(sunLightDirectionZ, 0.0))
    elevation = RemapValClamped(elevation, 0.0, 0.5 * math.pi, 0.0, #SkyModel_PhysicalSkyLightColors)
    
    local turbidity = RemapValClamped(skyHaze, 0.0, 1.0, 0.0, #SkyModel_PhysicalSkyLightColors[1])
    
    local eLower = Clamp(math.floor(elevation), 1, #SkyModel_PhysicalSkyLightColors - 1)
    local tLower = Clamp(math.floor(turbidity), 1, #SkyModel_PhysicalSkyLightColors[1] - 1)
    
    local e = elevation - eLower
    local t = turbidity - tLower
    
    local eLtL = SkyModel_PhysicalSkyLightColors[eLower + 0][tLower + 0]
    local eLtU = SkyModel_PhysicalSkyLightColors[eLower + 0][tLower + 1]
    local eUtL = SkyModel_PhysicalSkyLightColors[eLower + 1][tLower + 0]
    local eUtU = SkyModel_PhysicalSkyLightColors[eLower + 1][tLower + 1]
    
    local eL = VectorLerp(t, eLtL, eLtU)
    local eU = VectorLerp(t, eUtL, eUtU)
    return VectorLerp(e, eL, eU)
end


----------------------------------------------------------------------------------------------------------
function SkyModel_CreateDayNightCycle(keys) 
    local result = {}
    
    result.Date = keys:GetNumber("date", 1.0)
    result.DayLength = keys:GetNumber("daylength", 0.0)
    result.SynodicMonth = keys:GetNumber("synodic_month", 0.0)
    result.Location = keys:GetString("location", "")
    result.NorthAngle = Deg2Rad(keys:GetAngle("angles", QAngle(0.0, 0.0, 0.0)).y)
    if vlua.contains(SkyModel_Locations, result.Location) then 
        result = Merge(SkyModel_Locations[result.Location], result)
    else 
        result.Latitude = Deg2Rad(keys:GetNumber("custom_latitude", 0.0))
        result.Longitude = Deg2Rad(keys:GetNumber("custom_longitude", 0.0))
        result.Meridian = result.Longitude
        
        local custom_timezone = keys:GetString("custom_timezone", "UTC-08:00")
        if vlua.contains(SkyModel_StandardMeridians, custom_timezone) then 
            result.Meridian = SkyModel_StandardMeridians[custom_timezone]
        end
    end
    
    if false then 
        print("Day-Night Cycle:")
        print(" Date: " .. result.Date)
        print(" Day Length: " .. result.DayLength)
        print(" Synodic Month: " .. result.SynodicMonth)
        print(" Location: " .. result.Location)
        print(" Latitude: " .. Rad2Deg(result.Latitude))
        print(" Longitude: " .. Rad2Deg(result.Longitude))
        print(" Standard Meridian: " .. Rad2Deg(result.Meridian))
        print(" North Angle: " .. Rad2Deg(result.NorthAngle))
    end
    
    return result
end


----------------------------------------------------------------------------------------------------------
function Rayleigh(strength, rayleigh_color) 
    rayleigh_color = rayleigh_color or Vector(0.316, 0.448, 1.0)
    return Vector(1e-5 * strength * rayleigh_color.x, 1e-5 * strength * rayleigh_color.y, 1e-5 * strength * rayleigh_color.z)
end


----------------------------------------------------------------------------------------------------------
function Mie(strength, mie_color) 
    mie_color = mie_color or Vector(0.573, 0.680, 1.0)
    return Vector(1e-5 * strength * mie_color.x, 1e-5 * strength * mie_color.y, 1e-5 * strength * mie_color.z)
end


----------------------------------------------------------------------------------------------------------
function SkyModel_PrintLightInfo(dayNightCycle, haze) 
    local sunLightDirection = SkyModel_SunLightDirectionForDayNightCycle(dayNightCycle, 0.0)
    local sunLightColor = SkyModel_SunLightColorForLightParameters(haze, sunLightDirection.z)
    local skyLightColor = SkyModel_SkyLightColorForLightParameters(haze, sunLightDirection.z)
    local sunLightAngle1 = Rad2Deg(math.asin(sunLightDirection.z))
    local sunLightAngle2 = Rad2Deg(math.atan2(-sunLightDirection.y, -sunLightDirection.x))
    
    local scale = math.max(math.max(1.0, sunLightColor.x), math.max(sunLightColor.y, sunLightColor.z))
    local r = math.floor(255.0 * math.pow(sunLightColor.x / scale, 1.0 / 2.2))
    local g = math.floor(255.0 * math.pow(sunLightColor.y / scale, 1.0 / 2.2))
    local b = math.floor(255.0 * math.pow(sunLightColor.z / scale, 1.0 / 2.2))
    print("Sun Light Color: " .. r .. " " .. g .. " " .. b)
    print("Sun Light HDR Scale: " .. scale)
    print("Sun Light Angles: " .. sunLightAngle1 .. " " .. sunLightAngle2 .. " 0.0")
    
    local scale = math.max(math.max(1.0, skyLightColor.x), math.max(skyLightColor.y, skyLightColor.z))
    local r = math.floor(255.0 * math.pow(skyLightColor.x / scale, 1.0 / 2.2))
    local g = math.floor(255.0 * math.pow(skyLightColor.y / scale, 1.0 / 2.2))
    local b = math.floor(255.0 * math.pow(skyLightColor.z / scale, 1.0 / 2.2))
    print("Sky Light Color: " .. r .. " " .. g .. " " .. b)
    print("Sky Light HDR Scale: " .. scale)
end
