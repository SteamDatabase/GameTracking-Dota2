-- All blessing modifiers must be linked here
LinkLuaModifier( "modifier_blessing_bottle_upgrade", "modifiers/modifier_blessing_bottle_upgrade", LUA_MODIFIER_MOTION_NONE )
LinkLuaModifier( "modifier_blessing_armor", "modifiers/modifier_blessing_armor", LUA_MODIFIER_MOTION_NONE )
LinkLuaModifier( "modifier_blessing_attack_speed", "modifiers/modifier_blessing_attack_speed", LUA_MODIFIER_MOTION_NONE )
LinkLuaModifier( "modifier_blessing_evasion", "modifiers/modifier_blessing_evasion", LUA_MODIFIER_MOTION_NONE )
LinkLuaModifier( "modifier_blessing_mana_boost", "modifiers/modifier_blessing_mana_boost", LUA_MODIFIER_MOTION_NONE )
LinkLuaModifier( "modifier_blessing_health_boost", "modifiers/modifier_blessing_health_boost", LUA_MODIFIER_MOTION_NONE )
LinkLuaModifier( "modifier_blessing_magic_resist", "modifiers/modifier_blessing_magic_resist", LUA_MODIFIER_MOTION_NONE )
LinkLuaModifier( "modifier_blessing_magic_damage_bonus", "modifiers/modifier_blessing_magic_damage_bonus", LUA_MODIFIER_MOTION_NONE )
LinkLuaModifier( "modifier_blessing_damage_bonus", "modifiers/modifier_blessing_damage_bonus", LUA_MODIFIER_MOTION_NONE )
LinkLuaModifier( "modifier_blessing_movement_speed", "modifiers/modifier_blessing_movement_speed", LUA_MODIFIER_MOTION_NONE )
LinkLuaModifier( "modifier_blessing_damage_reflect", "modifiers/modifier_blessing_damage_reflect", LUA_MODIFIER_MOTION_NONE )
LinkLuaModifier( "modifier_blessing_spell_life_steal", "modifiers/modifier_blessing_spell_life_steal", LUA_MODIFIER_MOTION_NONE )
LinkLuaModifier( "modifier_blessing_life_steal", "modifiers/modifier_blessing_life_steal", LUA_MODIFIER_MOTION_NONE )
LinkLuaModifier( "modifier_blessing_potion_arcanist", "modifiers/modifier_blessing_potion_arcanist", LUA_MODIFIER_MOTION_NONE )
LinkLuaModifier( "modifier_blessing_potion_dragon", "modifiers/modifier_blessing_potion_dragon", LUA_MODIFIER_MOTION_NONE )
LinkLuaModifier( "modifier_blessing_potion_echo_slam", "modifiers/modifier_blessing_potion_echo_slam", LUA_MODIFIER_MOTION_NONE )
LinkLuaModifier( "modifier_blessing_potion_torrent", "modifiers/modifier_blessing_potion_torrent", LUA_MODIFIER_MOTION_NONE )
LinkLuaModifier( "modifier_blessing_potion_shadow_wave", "modifiers/modifier_blessing_potion_shadow_wave", LUA_MODIFIER_MOTION_NONE )
LinkLuaModifier( "modifier_blessing_potion_ravage", "modifiers/modifier_blessing_potion_ravage", LUA_MODIFIER_MOTION_NONE )
LinkLuaModifier( "modifier_blessing_potion_purification", "modifiers/modifier_blessing_potion_purification", LUA_MODIFIER_MOTION_NONE )
LinkLuaModifier( "modifier_blessing_respawn_time_reduction", "modifiers/modifier_blessing_respawn_time_reduction", LUA_MODIFIER_MOTION_NONE )
LinkLuaModifier( "modifier_blessing_respawn_invulnerability", "modifiers/modifier_blessing_respawn_invulnerability", LUA_MODIFIER_MOTION_NONE )
LinkLuaModifier( "modifier_blessing_death_detonation", "modifiers/modifier_blessing_death_detonation", LUA_MODIFIER_MOTION_NONE )
LinkLuaModifier( "modifier_blessing_strength", "modifiers/modifier_blessing_strength", LUA_MODIFIER_MOTION_NONE )
LinkLuaModifier( "modifier_blessing_agility", "modifiers/modifier_blessing_agility", LUA_MODIFIER_MOTION_NONE )
LinkLuaModifier( "modifier_blessing_intelligence", "modifiers/modifier_blessing_intelligence", LUA_MODIFIER_MOTION_NONE )
LinkLuaModifier( "modifier_blessing_potion_health", "modifiers/modifier_blessing_potion_health", LUA_MODIFIER_MOTION_NONE )
LinkLuaModifier( "modifier_blessing_potion_mana", "modifiers/modifier_blessing_potion_mana", LUA_MODIFIER_MOTION_NONE )
LinkLuaModifier( "modifier_blessing_restore_mana", "modifiers/modifier_blessing_restore_mana", LUA_MODIFIER_MOTION_NONE )
LinkLuaModifier( "modifier_blessing_book_strength", "modifiers/modifier_blessing_book_strength", LUA_MODIFIER_MOTION_NONE )
LinkLuaModifier( "modifier_blessing_book_agility", "modifiers/modifier_blessing_book_agility", LUA_MODIFIER_MOTION_NONE )
LinkLuaModifier( "modifier_blessing_book_intelligence", "modifiers/modifier_blessing_book_intelligence", LUA_MODIFIER_MOTION_NONE )
LinkLuaModifier( "modifier_blessing_refresher_shard", "modifiers/modifier_blessing_refresher_shard", LUA_MODIFIER_MOTION_NONE )
LinkLuaModifier( "modifier_blessing_bottle_regen_duration", "modifiers/modifier_blessing_bottle_regen_duration", LUA_MODIFIER_MOTION_NONE )
LinkLuaModifier( "modifier_blessing_bottle_regen_movement_speed", "modifiers/modifier_blessing_bottle_regen_movement_speed", LUA_MODIFIER_MOTION_NONE )
LinkLuaModifier( "modifier_blessing_roshan_shop_discount", "modifiers/modifier_blessing_roshan_shop_discount", LUA_MODIFIER_MOTION_NONE )
LinkLuaModifier( "modifier_blessing_oracle_shop_discount", "modifiers/modifier_blessing_oracle_shop_discount", LUA_MODIFIER_MOTION_NONE )
LinkLuaModifier( "modifier_blessing_respawn_haste", "modifiers/modifier_blessing_respawn_haste", LUA_MODIFIER_MOTION_NONE )
LinkLuaModifier( "modifier_blessing_respawn_attack_speed", "modifiers/modifier_blessing_respawn_attack_speed", LUA_MODIFIER_MOTION_NONE )
LinkLuaModifier( "modifier_blessing_upgrade_reroll", "modifiers/modifier_blessing_upgrade_reroll", LUA_MODIFIER_MOTION_NONE )
LinkLuaModifier( "modifier_blessing_elite_shard_upgrade", "modifiers/modifier_blessing_elite_shard_upgrade", LUA_MODIFIER_MOTION_NONE )
LinkLuaModifier( "modifier_blessing_boss_tome", "modifiers/modifier_blessing_boss_tome", LUA_MODIFIER_MOTION_NONE )
LinkLuaModifier( "modifier_blessing_extra_life", "modifiers/modifier_blessing_extra_life", LUA_MODIFIER_MOTION_NONE)
LinkLuaModifier( "modifier_blessing_attack_range", "modifiers/modifier_blessing_attack_range", LUA_MODIFIER_MOTION_NONE)
LinkLuaModifier( "modifier_blessing_projectile_speed", "modifiers/modifier_blessing_projectile_speed", LUA_MODIFIER_MOTION_NONE)
LinkLuaModifier( "modifier_blessing_cast_range", "modifiers/modifier_blessing_cast_range", LUA_MODIFIER_MOTION_NONE)
LinkLuaModifier( "modifier_blessing_damage_on_stunned", "modifiers/modifier_blessing_damage_on_stunned", LUA_MODIFIER_MOTION_NONE)
LinkLuaModifier( "modifier_low_hp_outgoing_damage", "modifiers/modifier_low_hp_outgoing_damage", LUA_MODIFIER_MOTION_NONE)








-- Uncomment + change blessing modifier names for debugging
-- DEPRECATED 2020
_G.BLESSING_MODIFIERS_FORCE_LIST =
{
--	modifier_blessing_bottle_upgrade = 1,	-- 1 is the claim count
--	modifier_blessing_armor = 1,
--	modifier_blessing_attack_speed = 1,
--	modifier_blessing_evasion = 1,
--	modifier_blessing_mana_boost = 1,
--	modifier_blessing_health_boost = 1,
--	modifier_blessing_magic_resist = 1,
--	modifier_blessing_magic_damage_bonus = 1,
--	modifier_blessing_damage_bonus = 1,
--	modifier_blessing_movement_speed = 1,
--	modifier_blessing_spell_life_steal = 1,
--	modifier_blessing_life_steal = 1,
--	grant_blessing_bonus_life = 1,
--	grant_blessing_potion_starting_mango = 1,
--	modifier_blessing_potion_arcanist = 1,
--	modifier_blessing_potion_dragon = 1,
--	modifier_blessing_potion_echo_slam = 1,
--	modifier_blessing_potion_torrent = 1,
--	modifier_blessing_potion_shadow_wave = 1,
--	modifier_blessing_potion_ravage = 1,
--	modifier_blessing_potion_purification = 1,
--	modifier_blessing_respawn_time_reduction = 1,
--	modifier_blessing_potion_health = 1,
--	modifier_blessing_potion_mana = 1,
--	modifier_blessing_restore_mana = 1,
--	grant_blessing_gold_start_bonus = 1,
--	modifier_blessing_respawn_invulnerability = 1,
--	modifier_blessing_death_detonation = 1,
--	modifier_blessing_book_strength = 1,
--	modifier_blessing_book_agility = 1,
--	modifier_blessing_book_intelligence = 1,
--	modifier_blessing_intelligence = 1,
--	modifier_blessing_refresher_shard = 1,
}

-- DEPRECATED 2020
_G.BLESSING_MODIFIERS =
{
--	example_blessing_modifier_name =
--	{
--		action_name = <associated action name>,
--		keys = 
--		{
--			<keys>
--		}
--	},
--
--  This version allows you to specify different keys per action level
--	example_blessing_modifier_name =
--	{
--		action_name = <associated action name>,
--		keys = 
--		{
--			{
--				<keys for level 1 blessing>
--			},
--			{
--				<keys for level 2 blessing>
--			},
--		}
--	},

	grant_blessing_potion_starting_mango =
	{
		scoreboard_order = 1,
		action_name = "blessing_potion_starting_mango",
		blessing_type = BLESSING_TYPE_ITEM_GRANT,
		keys =
		{
			items =
			{
				item_flask = 1,
				item_enchanted_mango = 1,
			}
		}
	},

	modifier_blessing_bottle_upgrade =
	{
		scoreboard_order = 1,
		action_name = "blessing_bottle_upgrade",
		keys =
		{
			max_charges = 1,
		},
	},

	-- Str Tree
	modifier_blessing_strength =
	{
		scoreboard_order = 102,
		action_names = 
		{
			"blessing_stat_str",
			"blessing_stat_str_2",
			"blessing_stat_str_3",
		},
		keys =
		{
			{
				str_bonus = 2
			},
			{
				str_bonus = 5
			},
			{
				str_bonus = 9
			},
		},
	},	

	modifier_blessing_book_strength =
	{
		scoreboard_order = 101,
		action_name = "blessing_book_strength",
		keys =
		{
			bonus_stat = 1
		},
	},

	modifier_blessing_armor =
	{
		scoreboard_order = 206,
		action_name = "blessing_armor_bonus",
		keys = 
		{
			bonus_armor = 2
		},
	},

	modifier_blessing_potion_health =
	{
		scoreboard_order = 103,
		action_name = "blessing_potion_health",
		keys =
		{
			hp_restore_pct_bonus = 20
		},
	},

	modifier_blessing_respawn_time_reduction =
	{
		scoreboard_order = 104,
		action_name = "blessing_respawn_time_reduction",
		keys =
		{
			respawn_time_reduction = 0.25
		},
	},

	modifier_blessing_potion_echo_slam =
	{
		scoreboard_order = 205,
		action_name = "blessing_potion_echo_slam",
		keys =
		{
			echo_slam_echo_damage_percent = 40,
		}
	},	

	modifier_blessing_health_boost =
	{
		scoreboard_order = 100,
		action_name = "blessing_health_boost",
		keys = 
		{
			bonus_health_per_level = 10
		},
	},

	modifier_blessing_damage_reflect =
	{
		scoreboard_order = 112,
		action_name = "blessing_damage_reflection",
		keys =
		{
			damage_reflect = 0.04
		}
	},

	modifier_blessing_potion_torrent =
	{
		scoreboard_order = 110,
		action_name = "blessing_potion_torrent",
		keys =
		{
			torrent_damage_percent = 50,
		}
	},	

	modifier_blessing_refresher_shard =
	{
		scoreboard_order = 11,
		action_name = "blessing_refresher_shard",
		keys =
		{
			health_restore_percent = 50,
		}
	},	

	grant_blessing_bonus_life =
	{
		scoreboard_order = 312,
		action_name = "blessing_bonus_life",
		blessing_type = BLESSING_TYPE_LIFE_GRANT,
		keys =
		{
			lives = 1,
		}
	},

	-- Agi tree
	modifier_blessing_agility =
	{
		scoreboard_order = 202,
		action_names = 
		{
			"blessing_stat_agi",
			"blessing_stat_agi_2",
			"blessing_stat_agi_3",
		},
		keys =
		{
			{
				agi_bonus = 2
			},
			{
				agi_bonus = 5
			},
			{
				agi_bonus = 9
			},
		},
	},	

	modifier_blessing_evasion =
	{
		scoreboard_order = 207,
		action_name = "blessing_evasion",
		keys = 
		{
			bonus_evasion = 5
		},
	},

	modifier_blessing_attack_speed =
	{
		scoreboard_order = 200,
		action_name = "blessing_attack_speed",
		keys = 
		{
			bonus_attack_speed = 10
		},
	},

	modifier_blessing_book_agility =
	{
		scoreboard_order = 201,
		action_name = "blessing_book_agility",
		keys =
		{
			bonus_stat = 1
		},
	},

	grant_blessing_gold_start_bonus =
	{
		scoreboard_order = 203,
		action_name = "blessing_gold_start_bonus",
		blessing_type = BLESSING_TYPE_GOLD_GRANT,
		keys =
		{
			gold_amount = 125,
		}
	},

	modifier_blessing_potion_purification =
	{
		scoreboard_order = 107,
		action_name = "blessing_potion_purification",
		keys =
		{
			radius_percent = 100,
		}
	},	

	modifier_blessing_life_steal =
	{
		scoreboard_order = 109,
		action_name = "blessing_life_steal",
		keys =
		{
			life_steal_pct = 5
		},
	},

	modifier_blessing_respawn_invulnerability =
	{
		scoreboard_order = 204,
		action_name = "blessing_respawn_invulnerability",
		keys =
		{
			respawn_invulnerability_time_bonus = 0.0,
			min_move_speed = 550,
			bonus_attack_speed = 50,
		},
	},

	modifier_blessing_potion_arcanist =
	{
		scoreboard_order = 304,
		action_name = "blessing_potion_arcanist",
		keys =
		{
			cooldown_reduction_percent = 50,
			manacost_reduction_percent = 50,
		},
	},

	modifier_blessing_potion_dragon =
	{
		scoreboard_order = 211,
		action_name = "blessing_potion_dragon",
		keys =
		{
			bonus_attack_damage_percent = 25,
		},
	},

	modifier_blessing_movement_speed =
	{
		scoreboard_order = 210,
		action_name = "blessing_movement_speed",
		keys = 
		{
			bonus_movement_speed = 8
		},
	},

	modifier_blessing_damage_bonus =
	{
		scoreboard_order = 212,
		action_name = "blessing_damage_bonus",
		keys = 
		{
			bonus_damage = 2
		},
	},

	-- Int tree
	modifier_blessing_intelligence =
	{
		scoreboard_order = 302,
		action_names = 
		{
			"blessing_stat_int",
			"blessing_stat_int_2",
			"blessing_stat_int_3",
		},
		keys =
		{
			{
				int_bonus = 2
			},
			{
				int_bonus = 5
			},
			{
				int_bonus = 9
			},
		},
	},	

	modifier_blessing_book_intelligence =
	{
		scoreboard_order = 303,
		action_name = "blessing_book_intelligence",
		keys =
		{
			bonus_stat = 1
		},
	},

	modifier_blessing_mana_boost =
	{
		scoreboard_order = 300,
		action_name = "blessing_mana_boost",
		keys = 
		{
			bonus_mana = 10
		},
	},

	modifier_blessing_potion_mana =
	{
		scoreboard_order = 301,
		action_name = "blessing_potion_mana",
		keys =
		{
			mana_restore_pct_bonus = 20
		},
	},

	modifier_blessing_spell_life_steal =
	{
		scoreboard_order = 311,
		action_name = "blessing_spell_life_steal",
		keys =
		{
			spell_life_steal = 5
		},
	},

	modifier_blessing_potion_shadow_wave =
	{
		scoreboard_order = 106,
		action_name = "blessing_potion_shadow_wave",
		keys =
		{
			damage_percent = 50,
		}
	},	

	modifier_blessing_death_detonation =
	{
		scoreboard_order = 105,
		action_name = "blessing_death_detonation",
		keys =
		{
			detonation_damage_per_level = 100,
			detonation_radius = 350,
		},
	},

	modifier_blessing_magic_resist =
	{
		scoreboard_order = 307,
		action_name = "blessing_magic_resist",
		keys = 
		{
			bonus_magic_resist = 5
		},
	},

	modifier_blessing_potion_ravage =
	{
		scoreboard_order = 308,
		action_name = "blessing_potion_ravage",
		keys =
		{
			duration_percent = 50,
		}
	},	

	modifier_blessing_restore_mana =
	{
		scoreboard_order = 305,
		action_name = "blessing_restore_mana",
		keys =
		{
			mana_on_kill = 6
		},
	},

	modifier_blessing_magic_damage_bonus =
	{
		scoreboard_order = 309,
		action_name = "blessing_magic_damage_bonus",
		keys = 
		{
			bonus_magic_damage = 6
		},
	},
}

_G.BLESSING_DEFINITIONS =
{
	bottle_charges =
	{
		grant_blessing = function( nPlayerID, hHero, nBlessingValue )
			local hModifier = hHero:AddNewModifier( hHero, nil, "modifier_blessing_bottle_upgrade", {} )
			hModifier:SetStackCount( nBlessingValue )

			local hBottle = hHero:GetItemInSlot( DOTA_ITEM_TP_SCROLL)
			if hBottle and hBottle:GetAbilityName() == "item_bottle" then
				hBottle:SetCurrentCharges( hBottle:GetSpecialValueFor( "max_charges" ) )
			end
		end,
	},
	stat_agi =
	{
		modifier_name = "modifier_blessing_agility",
	},
	stat_int =
	{
		modifier_name = "modifier_blessing_intelligence",
	},
	stat_str =
	{
		modifier_name = "modifier_blessing_strength",
	},
	stat_damage =
	{
		modifier_name = "modifier_blessing_damage_bonus",
	},
	stat_spell_amp =
	{
		modifier_name = "modifier_blessing_magic_damage_bonus",
	},
	stat_health =
	{
		modifier_name = "modifier_blessing_health_boost",
	},
	stat_mana =
	{
		modifier_name = "modifier_blessing_mana_boost",
	},
	stat_armor =
	{
		modifier_name = "modifier_blessing_armor",
	},
	stat_magic_resist =
	{
		modifier_name = "modifier_blessing_magic_resist",
	},
	starting_gold =
	{
		grant_blessing = function( nPlayerID, hHero, nBlessingValue )
			if nBlessingValue > 0 then
				PlayerResource:ModifyGold( nPlayerID, nBlessingValue, true, DOTA_ModifyGold_Unspecified )
			end
		end,
	},
	purification_potion =
	{
		grant_blessing = function( nPlayerID, hHero, nBlessingValue )
			if nBlessingValue > 0 then
				local vPotionList = {}
				--doubling up less potent potions
				table.insert(vPotionList, "item_purification_potion")
				table.insert(vPotionList, "item_ravage_potion")
				table.insert(vPotionList, "item_arcanist_potion")
				table.insert(vPotionList, "item_echo_slam_potion")
				table.insert(vPotionList, "item_purification_potion")
				table.insert(vPotionList, "item_ravage_potion")
				table.insert(vPotionList, "item_arcanist_potion")
				table.insert(vPotionList, "item_echo_slam_potion")

				table.insert(vPotionList, "item_dragon_potion")

				local iPotionToGrant = RandomInt(1,#vPotionList)
				for i = 1, nBlessingValue do
					GrantItemDropToHero( hHero, vPotionList[iPotionToGrant] )
				end
			end
		end,
	},
	death_detonation =
	{
		modifier_name = "modifier_blessing_death_detonation",
	},
	potion_health =
	{
		modifier_name = "modifier_blessing_potion_health",
	},
	potion_mana =
	{
		modifier_name = "modifier_blessing_potion_mana",
	},
	respawn_time_reduction =
	{
		modifier_name = "modifier_blessing_respawn_time_reduction",
	},
	bottle_regen_duration =
	{
		modifier_name = "modifier_blessing_bottle_regen_duration",
	},
	bottle_regen_movement_speed =
	{
		modifier_name = "modifier_blessing_bottle_regen_movement_speed",
	},
	roshan_shop_discount =
	{
		modifier_name = "modifier_blessing_roshan_shop_discount",
	},
	oracle_shop_discount =
	{
		modifier_name = "modifier_blessing_oracle_shop_discount",
	},
	respawn_invulnerability =
	{
		modifier_name = "modifier_blessing_respawn_invulnerability",
	},
	respawn_haste =
	{
		modifier_name = "modifier_blessing_respawn_haste",
	},
	respawn_attack_speed =
	{
		modifier_name = "modifier_blessing_respawn_attack_speed",
	},	
	stat_evasion =
	{
		modifier_name = "modifier_blessing_evasion",
	},	
	upgrade_reroll =
	{
		modifier_name = "modifier_blessing_upgrade_reroll",
	},	
	elite_upgrade =
	{
		modifier_name = "modifier_blessing_elite_shard_upgrade",
	},
	start_tome =
	{
		grant_blessing = function( nPlayerID, hHero, nBlessingValue )
			local nAttribute = hHero:GetPrimaryAttribute()
			for i = 1, math.floor( nBlessingValue / 3 ) do
				if nAttribute == 0 then
					GrantItemDropToHero( hHero, "item_book_of_blessed_strength" )
				elseif nAttribute == 1 then
					GrantItemDropToHero( hHero, "item_book_of_blessed_agility" )
				else
					GrantItemDropToHero( hHero, "item_book_of_blessed_intelligence" )
				end
			end
		end,
	},
	boss_tome =
	{
		modifier_name = "modifier_blessing_boss_tome",
	},
	extra_life =
	{
		modifier_name = "modifier_blessing_extra_life",
	},
	melee_cleave = 
	{
		grant_blessing = function( nPlayerID, hHero, nBlessingValue )
			local hAbility = hHero:AddAbility("blessings_melee_cleave")
			if hAbility ~= nil then
				hAbility:UpgradeAbility(true)
				local hAbilityModifier = hHero:FindModifierByName(hAbility:GetIntrinsicModifierName())
				if hAbilityModifier ~= nil then
					hAbilityModifier:SetStackCount(nBlessingValue)
				end
			end
		end
	},
	attack_range = 
	{
		modifier_name = "modifier_blessing_attack_range"
	},
	projectile_speed = 
	{
		modifier_name = "modifier_blessing_projectile_speed"
	},
	cast_range = 
	{
		modifier_name = "modifier_blessing_cast_range"
	},
	damage_on_stunned = 
	{
		modifier_name = "modifier_blessing_damage_on_stunned"
	},
	regen_around_allies = 
	{
		grant_blessing = function( nPlayerID, hHero, nBlessingValue )
			local hAbility = hHero:AddAbility("blessings_regen_around_allies")
			if hAbility ~= nil then
				hAbility:UpgradeAbility(true)
				local hAbilityModifier = hHero:FindModifierByName(hAbility:GetIntrinsicModifierName())
				if hAbilityModifier ~= nil then
					hAbilityModifier:SetStackCount(nBlessingValue)
				end
			end
		end
	},	
	debuff_duration_increase = 
	{
		modifier = "modifier_blessings_debuff_duration_increase"
	},
	low_hp_outgoing_damage = 
	{
		modifier = "modifier_low_hp_outgoing_damage"
	}


}